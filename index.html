<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Lock-In Lab v5</title>
    <style>
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: #020617; color: #f8fafc;
            padding: 20px; margin: 0; display: flex; flex-direction: column; gap: 20px;
        }
        .card {
            background: #1e293b; border-radius: 16px; padding: 20px;
            border: 1px solid #334155;
        }
        h2 { margin: 0 0 10px 0; font-size: 18px; color: #22c55e; }
        button {
            width: 100%; padding: 20px; border-radius: 12px; border: none;
            background: #22c55e; color: #000; font-weight: 800; font-size: 18px;
            cursor: pointer; transition: 0.1s;
        }
        button:active { background: #4ade80; transform: scale(0.98); }
        .data-box {
            background: #000; color: #4ade80; font-family: monospace;
            padding: 12px; border-radius: 8px; font-size: 14px; margin-bottom: 12px;
        }
        .instructions {
            font-size: 13px; color: #94a3b8; background: #0f172a;
            padding: 15px; border-radius: 10px; border: 1px dashed #334155;
        }
    </style>
</head>
<body>

    <h1>PWA Hardware Test</h1>

    <div class="instructions">
        <strong>TO TEST PROPERLY:</strong><br>
        1. Click Share -> <strong>Add to Home Screen</strong>.<br>
        2. Open the app from your home screen.<br>
        3. Ensure <strong>Silent Switch is OFF</strong>.<br>
        4. Enable Notifications if prompted.
    </div>

    <div class="card">
        <h2>ðŸ“³ Pulse (Force Vibrate)</h2>
        <div id="vibStatus" class="data-box">Status: Ready</div>
        <button id="vibBtn">TRIGGER VIBRATION</button>
    </div>

    <div class="card">
        <h2>ðŸ”” Notification Test</h2>
        <p style="font-size: 12px; margin-bottom: 10px;">Notifications in PWA mode can force a haptic response.</p>
        <button id="notifBtn" style="background:#3b82f6; color:white;">Request & Send Notif</button>
    </div>

    <div class="card">
        <h2>ðŸ”„ Gyro Audit</h2>
        <div id="gyroData" class="data-box">B: 0 | G: 0</div>
        <button onclick="startGyro()" style="background:#334155; color:white;">Start Sensors</button>
    </div>

    <script>
        const vibBtn = document.getElementById('vibBtn');
        const vibStatus = document.getElementById('vibStatus');

        // 1. Standard Vibrate
        vibBtn.onclick = () => {
            if (navigator.vibrate) {
                // Try long pulse for iOS recognition
                const success = navigator.vibrate([500, 200, 500]);
                vibStatus.innerText = success ? "API Success (Check Phone)" : "API Denied";
            } else {
                vibStatus.innerText = "API Unsupported";
            }
            
            // Visual feedback
            document.body.style.background = "#ffffff";
            setTimeout(() => document.body.style.background = "#020617", 100);
        };

        // 2. Notification Haptic Bypass
        document.getElementById('notifBtn').onclick = async () => {
            const permission = await Notification.requestPermission();
            if (permission === "granted") {
                new Notification("Lock-In Pulse", {
                    body: "Legitimacy Check Required!",
                    silent: false // Setting silent to false forces a system haptic/sound
                });
            }
        };

        // 3. Gyroscope
        async function startGyro() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                const res = await DeviceOrientationEvent.requestPermission();
                if (res === 'granted') {
                    window.addEventListener('deviceorientation', (e) => {
                        document.getElementById('gyroData').innerText = `B: ${Math.round(e.beta)} | G: ${Math.round(e.gamma)}`;
                    });
                }
            }
        }
    </script>
</body>
</html>

